<?php

namespace App\Models;

// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// LARAVEL
// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;



use Carbon\Carbon;

class Plan extends Model
{
	use SoftDeletes;

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// VARIABLES
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	protected $table    = 'SUBSC_plans';
	public $timestamps  = true;
	protected $fillable = [
		'name', 
		'period', 
		'published_at', 
	];

	protected $hidden = [
	];

	protected $casts = [
	];

	protected $dates = [
		'published_at',
		'deleted_at'
	];

	protected $touches = [
	];

	protected $dispatchesEvents = [

    ];

	/*=====================================
	=            CONFIGURATION            =
	=====================================*/
	const APP_ID = ['BASIL_POS'];
	/*=====  End of CONFIGURATION  ======*/
	


	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// CONSTRUCT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// RELATIONSHIP
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function price($date = 'now')
	{
		$now 	= Carbon::parse($date);
		return $this->hasOne(Price::class)->where('started_at', '<=', $now)->orderby('started_at', 'desc');
	}
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// STATIC FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function getRules()
	{
		return [
			'app_id'      	=> ['nullable', 'in:' . implode(',', SELF::APP_ID)],
			'name'       	=> ['required', 'string'],
			'period'      	=> ['required', 'numeric'],
			'published_at' 	=> ['nullable', 'date', 'after:now'],
		];
	}

	public function getRelationships()
	{
		return [];
	}

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// ACCESSOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// MUTATOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// QUERY
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

}
