<?php

namespace App\Models;

// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// LARAVEL
// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
use App\Events\Subscription\SubscriptionCreating;
use App\Events\Subscription\SubscriptionSaving;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;



use Carbon\Carbon;

class Subscription extends Model
{
	use SoftDeletes;

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// VARIABLES
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	protected $table    = 'SUBSC_subscriptions';
	public $timestamps  = true;
	protected $fillable = [
		'plan_id', 
		'user_id',
		'uuid', 
		'is_auto_extend', 
		'ended_at', 
	];

	protected $hidden = [
	];

	protected $casts = [
	];

	protected $dates = [
		'ended_at',
		'deleted_at'
	];

	protected $touches = [
	];

	protected $dispatchesEvents = [
        'creating' 	=> SubscriptionCreating::class,
        'saving'    => SubscriptionSaving::class,

    ];
	/*=====================================
	=            CONFIGURATION            =
	=====================================*/
	/*=====  End of CONFIGURATION  ======*/
	

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// CONSTRUCT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// RELATIONSHIP
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function plan(){
		return $this->belongsTo(Plan::class)->withTrashed();
	}

	public function price(){
		return $this->plan->price($this->created_at);
	}


	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// STATIC FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function getRules()
	{
		return [
			'plan_id'      		=> ['required', 'exists:'.(new Plan())->getTable().',id'],
			'organization_id'	=> ['required', 'string'],
			'is_auto_extend' 	=> ['boolean'],
			'ended_at' 			=> ['nullable', 'date', 'after:now'],
		];
	}

	public function getRelationships()
	{
		return [];
	}



	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// ACCESSOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// MUTATOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// QUERY
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	

}
